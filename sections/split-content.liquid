{%- comment -%}
  ----------------------------------------------------------------------------------
  RYSSA SPLIT CONTENT
  - Layout: Image Left / Image Right
  - Style: Custom Colors via Schema
  - Features: Parallax Image & Fade-In Content
  ----------------------------------------------------------------------------------
{%- endcomment -%}

<style>
  #shopify-section-{{ section.id }} .split-block {
    background-color: {{ section.settings.bg_color }};
    color: {{ section.settings.text_color }};
  }
  #shopify-section-{{ section.id }} .eyebrow,
  #shopify-section-{{ section.id }} .arrow-link {
    color: {{ section.settings.accent_color }};
  }
  #shopify-section-{{ section.id }} h2 {
    color: {{ section.settings.text_color }};
  }
</style>

{% liquid
  assign layout_class = ''
  if section.settings.layout == 'image_right'
    assign layout_class = 'split-block--reverse'
  endif
%}

<section class="split-block {{ layout_class }}" data-section-id="{{ section.id }}">
  
  <div class="split-block__image parallax-element">
    {%- if section.settings.image != blank -%}
      {{ section.settings.image | image_url: width: 1280 | image_tag: 
        loading: 'lazy',
        width: section.settings.image.width,
        height: section.settings.image.height,
        sizes: '(min-width: 990px) 50vw, 100vw',
        alt: section.settings.image.alt | escape
      }}
    {%- else -%}
      {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
    {%- endif -%}
  </div>

  <div class="split-block__content fade-in">
    {%- if section.settings.eyebrow != blank -%}
      <span class="eyebrow">{{ section.settings.eyebrow }}</span>
    {%- endif -%}

    {%- if section.settings.title != blank -%}
      <h2>{{ section.settings.title }}</h2>
    {%- endif -%}

    {%- if section.settings.text != blank -%}
      <div class="rte">
        {{ section.settings.text }}
      </div>
    {%- endif -%}

    {%- if section.settings.link_text != blank and section.settings.link_url != blank -%}
      <a href="{{ section.settings.link_url }}" class="arrow-link">
        <span>{{ section.settings.link_text }}</span>
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M4 10H16M16 10L11 5M16 10L11 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </a>
    {%- endif -%}
  </div>

</section>

{% schema %}
{
  "name": "Split Content Block",
  "tag": "section",
  "class": "section-split-content",
  "settings": [
    {
      "type": "header",
      "content": "Image"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow Text",
      "default": "The Collection"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Timeless Elegance"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Description",
      "default": "<p>Discover pieces designed for the modern wardrobe, where simplicity meets sophistication.</p>"
    },
    {
      "type": "text",
      "id": "link_text",
      "label": "Link Label",
      "default": "View Collection"
    },
    {
      "type": "url",
      "id": "link_url",
      "label": "Link URL"
    },
    {
      "type": "header",
      "content": "Layout & Colors"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Image Position",
      "options": [
        { "value": "image_left", "label": "Left" },
        { "value": "image_right", "label": "Right" }
      ],
      "default": "image_left"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#F8F6F3"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#1A1A1A"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent Color",
      "default": "#8B7355"
    }
  ],
  "presets": [
    {
      "name": "Split Content Block"
    }
  ]
}
{% endschema %}

{% stylesheet %}
  /* ========================================
     SPLIT CONTENT BLOCK CSS
     ======================================== */

  .split-block {
    display: grid;
    grid-template-columns: 1fr;
    min-height: auto;
    position: relative;
    overflow: hidden;
  }

  .split-block__image {
    position: relative;
    overflow: hidden;
    min-height: 400px; /* Mobile minimum height */
  }

  .split-block__image img,
  .split-block__image svg {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    position: absolute; /* Essential for parallax */
    top: 0; left: 0;
  }

  .split-block__content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 48px 24px; /* spacing-2xl spacing-md */
  }

  .split-block__content h2 {
    font-family: var(--font-display);
    font-weight: 300;
    line-height: 1.2;
    margin-bottom: 24px;
    font-size: clamp(2rem, 4vw, 3.052rem);
  }

  .split-block__content p {
    color: inherit;
    opacity: 0.8;
    max-width: 540px;
    margin-bottom: 1em;
  }

  .split-block__content .arrow-link {
    margin-top: 32px; /* spacing-lg */
  }

  /* --- Styles for Arrow Link --- */
  .arrow-link {
    display: inline-flex;
    align-items: center;
    gap: 8px; /* spacing-xs */
    font-size: 14px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.1em; /* tracking-wide */
    transition: gap 0.3s cubic-bezier(0.16, 1, 0.3, 1), color 0.15s ease;
    text-decoration: none;
  }

  .arrow-link:hover {
    gap: 16px; /* spacing-sm */
    opacity: 0.8;
  }

  .arrow-link svg {
    transition: transform 0.3s ease;
  }

  .arrow-link:hover svg {
    transform: translateX(4px);
  }

  /* --- Responsive Layouts --- */
  @media screen and (min-width: 768px) {
    .split-block {
      grid-template-columns: 1fr 1fr;
      min-height: 80vh;
    }
    
    .split-block__content {
      padding: 80px 48px;
    }

    /* Reverse Layout */
    .split-block--reverse {
      direction: rtl;
    }
    
    .split-block--reverse > * {
      direction: ltr;
    }
  }

  @media screen and (min-width: 1024px) {
    .split-block__content {
      padding: 120px; /* spacing-3xl */
    }
  }
{% endstylesheet %}

<script>
  (function() {
    // Scoped JS for this specific section type
    
    const initSection = (section) => {
      if (!section) return;

      // 1. FADE IN OBSERVER
      const fadeElements = section.querySelectorAll('.fade-in');
      if (fadeElements.length > 0) {
        if ('IntersectionObserver' in window) {
          const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                observer.unobserve(entry.target);
              }
            });
          }, { threshold: 0.1 });
          fadeElements.forEach(el => observer.observe(el));
        } else {
          fadeElements.forEach(el => el.classList.add('visible'));
        }
      }

      // 2. PARALLAX EFFECT
      // Only active on desktop/tablet to match your CSS media queries
      const parallaxContainer = section.querySelector('.parallax-element');
      const parallaxImg = section.querySelector('.parallax-element img, .parallax-element svg');
      
      if (parallaxContainer && parallaxImg && window.matchMedia('(min-width: 768px)').matches) {
        
        // Ensure image is tall enough for parallax
        parallaxImg.style.height = '120%'; 
        parallaxImg.style.top = '-10%';

        const onScroll = () => {
          const rect = parallaxContainer.getBoundingClientRect();
          const viewportHeight = window.innerHeight;

          // If in view
          if (rect.top < viewportHeight && rect.bottom > 0) {
            const speed = 0.15; // Parallax intensity
            const center = viewportHeight / 2;
            const elementCenter = rect.top + (rect.height / 2);
            
            // Calculate offset based on distance from center of viewport
            const yPos = (elementCenter - center) * speed;
            
            parallaxImg.style.transform = `translateY(${yPos}px)`;
          }
        };

        window.addEventListener('scroll', () => window.requestAnimationFrame(onScroll), { passive: true });
        // Initial trigger
        onScroll();
      }
    };

    // Initialize when section loads
    document.addEventListener('DOMContentLoaded', () => {
      const section = document.querySelector('[data-section-id="{{ section.id }}"]');
      initSection(section);
    });

    // Re-init for Shopify Editor interactions
    document.addEventListener('shopify:section:load', (e) => {
      if (e.target.dataset.sectionId === '{{ section.id }}') {
        initSection(e.target);
      }
    });
  })();
</script>