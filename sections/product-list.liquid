{%- comment -%}
  ----------------------------------------------------------------------------------
  RYSSA PRODUCT GRID
  - Dynamic collection loop
  - Automatic Badging (New, Sale, Sold Out)
  ----------------------------------------------------------------------------------
{%- endcomment -%}

<section class="product-grid section" data-section-id="{{ section.id }}">
  <div class="container">
    
    {%- if section.settings.title != blank or section.settings.eyebrow != blank -%}
      <header class="section-header fade-in">
        {%- if section.settings.eyebrow != blank -%}
          <span class="eyebrow">{{ section.settings.eyebrow }}</span>
        {%- endif -%}
        {%- if section.settings.title != blank -%}
          <h2 class="section-title">{{ section.settings.title }}</h2>
        {%- endif -%}
      </header>
    {%- endif -%}

    <div class="product-grid__items">
      {%- assign collection = section.settings.collection -%}
      {%- assign limit = section.settings.products_to_show -%}

      {%- if collection != blank and collection.products_count > 0 -%}
        {%- for product in collection.products limit: limit -%}
          <article class="product-card fade-in">
            <a href="{{ product.url }}" class="product-card__link">
              
              <div class="product-card__image">
                {%- comment -%} Badge Logic {%- endcomment -%}
                {%- if product.available == false -%}
                  <span class="product-card__badge">Sold Out</span>
                {%- elsif product.compare_at_price > product.price -%}
                  <span class="product-card__badge">Sale</span>
                {%- elsif product.tags contains 'New' or product.tags contains 'new' -%}
                  <span class="product-card__badge">New</span>
                {%- endif -%}

                {%- if product.featured_media -%}
                  {{ product.featured_media | image_url: width: 1200 | image_tag: 
                    loading: 'lazy',
                    width: product.featured_media.width,
                    height: product.featured_media.height,
                    sizes: '(min-width: 990px) 25vw, (min-width: 750px) 33vw, 50vw',
                    alt: product.title | escape
                  }}
                {%- else -%}
                  {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                {%- endif -%}
              </div>

              <div class="product-card__info">
                <h3 class="product-card__title">{{ product.title }}</h3>
                <div class="product-card__price">
                  {%- if product.compare_at_price > product.price -%}
                    <span class="visually-hidden">Regular price</span>
                    <s style="color: var(--color-text-secondary); margin-right: 5px;">{{ product.compare_at_price | money }}</s>
                    <span class="visually-hidden">Sale price</span>
                    {{ product.price | money }}
                  {%- else -%}
                    {{ product.price | money }}
                  {%- endif -%}
                </div>
              </div>
            </a>
          </article>
        {%- endfor -%}
      
      {%- else -%}
        {%- comment -%} EMPTY STATE (Placeholders) {%- endcomment -%}
        {%- for i in (1..limit) -%}
          <article class="product-card fade-in">
            <a href="#" class="product-card__link">
              <div class="product-card__image">
                <span class="product-card__badge">New</span>
                {%- capture placeholder_index -%}{% cycle 1, 2, 3, 4, 5, 6 %}{%- endcapture -%}
                {{ 'product-' | append: placeholder_index | placeholder_svg_tag: 'placeholder-svg' }}
              </div>
              <div class="product-card__info">
                <h3 class="product-card__title">Example Product {{ i }}</h3>
                <p class="product-card__price">{{ 19900 | money }}</p>
              </div>
            </a>
          </article>
        {%- endfor -%}
      {%- endif -%}
    </div>
  </div>
</section>

{% stylesheet %}
  /* ========================================
     PRODUCT GRID CSS
     ======================================== */

  .product-grid__items {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--spacing-xl) var(--spacing-md);
  }

  .product-card {
    display: block;
  }

  .product-card__link {
    display: block;
    transition: opacity var(--duration-fast) var(--ease-default);
  }

  .product-card__image {
    position: relative;
    aspect-ratio: 3 / 4;
    margin-bottom: var(--spacing-sm);
    overflow: hidden;
    background-color: var(--color-cloud);
  }

  .product-card__image img,
  .product-card__image svg {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--duration-slow) var(--ease-smooth);
  }

  /* Hover Effects */
  @media (hover: hover) {
    .product-card:hover .product-card__image img,
    .product-card:hover .product-card__image svg {
      transform: scale(1.05);
      opacity: 0.95;
    }
    
    .product-card:hover .product-card__badge {
      transform: scale(1.05);
    }
  }

  .product-card__badge {
    position: absolute;
    top: var(--spacing-sm);
    left: var(--spacing-sm);
    padding: 6px 12px;
    font-size: 11px;
    font-weight: var(--font-semibold);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
    background-color: var(--color-primary);
    color: var(--color-black);
    border-radius: var(--radius-sm);
    z-index: 2;
    box-shadow: 0 2px 8px rgba(233, 245, 255, 0.3);
    transition: transform var(--duration-fast) var(--ease-smooth);
  }

  .product-card__info {
    text-align: center;
  }

  .product-card__title {
    font-size: var(--text-base);
    font-weight: var(--font-regular);
    margin-bottom: var(--spacing-xs);
    line-height: var(--leading-normal);
  }

  .product-card__price {
    font-size: var(--text-base);
    color: var(--color-text-secondary);
  }
  
  /* Mobile Adjustments */
  @media (max-width: 480px) {
    .product-grid__items {
      grid-template-columns: 1fr;
    }
  }
{% endstylesheet %}

<script>
  // Simple intersection observer for this section's fade-in elements
  document.addEventListener('DOMContentLoaded', function() {
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    document.querySelectorAll('.product-grid .fade-in').forEach(el => observer.observe(el));
  });
</script>

{% schema %}
{
  "name": "Ryssa Product Grid",
  "settings": [
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow Text",
      "default": "New Arrivals"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Spring Essentials"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 4,
      "max": 12,
      "step": 1,
      "default": 4,
      "label": "Maximum products to show"
    }
  ],
  "presets": [
    {
      "name": "Ryssa Product Grid"
    }
  ]
}
{% endschema %}