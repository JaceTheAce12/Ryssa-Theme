{%- comment -%}
  ----------------------------------------------------------------------------------
  RYSSA HERO SECTION
  - Fixed: image_tag syntax error
  - Fixed: loading attribute logic (eager/lazy)
  ----------------------------------------------------------------------------------
{%- endcomment -%}

{% liquid
  # --- Performance Logic ---
  assign loading_attr = 'lazy'
  assign fetch_priority_attr = 'auto'
  
  if section.index == 1
    assign loading_attr = 'eager'
    assign fetch_priority_attr = 'high'
  endif

  # --- Media Logic ---
  assign desktop_media_type = section.settings.desktop_media_type
  assign mobile_media_type = section.settings.mobile_media_type
  
  # Check if we really have mobile media to show
  assign has_mobile_media = false
  if mobile_media_type == 'image' and section.settings.image_mobile != blank
    assign has_mobile_media = true
  elsif mobile_media_type == 'video' and section.settings.video_mobile != blank
    assign has_mobile_media = true
  endif
%}

<section class="hero" data-section-id="{{ section.id }}">
  
  <div class="hero__background parallax-element">
    
    {%- comment -%} 
      1. VIDEO HANDLING 
    {%- endcomment -%}
    {%- if desktop_media_type == 'video' and section.settings.video_desktop != blank -%}
      <div class="hero-video-container {% if has_mobile_media %}desktop-only{% endif %}">
        {{ section.settings.video_desktop | video_tag: autoplay: true, loop: true, muted: true, controls: false, class: 'hero-video', image_size: '1920x' }}
      </div>
    {%- endif -%}

    {%- if has_mobile_media and mobile_media_type == 'video' -%}
      <div class="hero-video-container mobile-only">
        {{ section.settings.video_mobile | video_tag: autoplay: true, loop: true, muted: true, controls: false, class: 'hero-video', image_size: '800x' }}
      </div>
    {%- endif -%}

    {%- comment -%} 
      2. IMAGE HANDLING (Picture Tag)
    {%- endcomment -%}
    
    {%- if desktop_media_type == 'image' or has_mobile_media -%}
      {%- unless desktop_media_type == 'video' and mobile_media_type == 'video' -%}
        <picture>
          {%- comment -%} Mobile Source {%- endcomment -%}
          {%- if has_mobile_media and mobile_media_type == 'image' -%}
            <source 
              media="(max-width: 767px)" 
              srcset="{{ section.settings.image_mobile | image_url: width: 400 }} 400w, 
                      {{ section.settings.image_mobile | image_url: width: 600 }} 600w, 
                      {{ section.settings.image_mobile | image_url: width: 800 }} 800w"
            >
          {%- endif -%}

          {%- comment -%} Desktop Source (Only if desktop is image) {%- endcomment -%}
          {%- if desktop_media_type == 'image' and section.settings.image_desktop != blank -%}
             <source 
              media="(min-width: 768px)" 
              srcset="{{ section.settings.image_desktop | image_url: width: 1200 }} 1200w, 
                      {{ section.settings.image_desktop | image_url: width: 1600 }} 1600w, 
                      {{ section.settings.image_desktop | image_url: width: 2000 }} 2000w,
                      {{ section.settings.image_desktop | image_url: width: 3000 }} 3000w"
            >
            {%- assign main_image = section.settings.image_desktop -%}
          {%- elsif has_mobile_media and mobile_media_type == 'image' -%}
            {%- comment -%} Fallback if only mobile image exists {%- endcomment -%}
            {%- assign main_image = section.settings.image_mobile -%}
          {%- else -%}
             {%- assign main_image = blank -%}
          {%- endif -%}

          {%- if main_image != blank -%}
            {{ main_image | image_url: width: 3840 | image_tag:
              loading: loading_attr,
              fetchpriority: fetch_priority_attr,
              alt: main_image.alt,
              class: 'hero-img'
            }}
          {%- else -%}
            {%- if desktop_media_type == 'image' -%}
              {{ 'lifestyle-1' | placeholder_svg_tag: 'hero-img placeholder-svg' }}
            {%- endif -%}
          {%- endif -%}
        </picture>
      {%- endunless -%}
    {%- endif -%}

    <div class="hero__overlay" style="background-color: {{ section.settings.overlay_color }}; opacity: {{ section.settings.overlay_opacity | divided_by: 100.0 }}"></div>
    
    {%- if section.settings.show_accent_line -%}
      <div class="hero__accent-line"></div>
    {%- endif -%}
  </div>

  <div class="hero__content fade-in">
    {%- if section.settings.eyebrow != blank -%}
      <span class="hero__eyebrow">{{ section.settings.eyebrow }}</span>
    {%- endif -%}
    
    {%- if section.settings.title != blank -%}
      <h1 class="hero__headline">{{ section.settings.title }}</h1>
    {%- endif -%}
    
    {%- if section.settings.text != blank -%}
      <p class="hero__subheadline">{{ section.settings.text }}</p>
    {%- endif -%}
    
    {%- if section.settings.link_text != blank and section.settings.link != blank -%}
      <a href="{{ section.settings.link }}" class="button button--primary hero__cta">
        {{ section.settings.link_text }}
      </a>
    {%- endif -%}
  </div>
</section>

<style>
  /* Local overrides */
  .hero-img, .hero-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    position: absolute;
    top: 0;
    left: 0;
  }
  
  .hero-video-container {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
  }

  .desktop-only { display: block; }
  .mobile-only { display: none; }

  @media screen and (max-width: 767px) {
    .desktop-only { display: none; }
    .mobile-only { display: block; }
    
    .hero-video-container.mobile-only {
      display: block;
      height: 100%;
    }
  }
</style>

{% schema %}
{
  "name": "Ryssa Hero",
  "settings": [
    {
      "type": "header",
      "content": "Desktop Media"
    },
    {
      "type": "select",
      "id": "desktop_media_type",
      "label": "Media Type",
      "options": [
        { "value": "image", "label": "Image" },
        { "value": "video", "label": "Video" }
      ],
      "default": "image"
    },
    {
      "type": "image_picker",
      "id": "image_desktop",
      "label": "Image"
    },
    {
      "type": "video",
      "id": "video_desktop",
      "label": "Video (MP4/Shopify Hosted)"
    },
    {
      "type": "header",
      "content": "Mobile Media (Optional)"
    },
    {
      "type": "paragraph",
      "content": "If left blank, desktop media will be used."
    },
    {
      "type": "select",
      "id": "mobile_media_type",
      "label": "Mobile Media Type",
      "options": [
        { "value": "image", "label": "Image" },
        { "value": "video", "label": "Video" }
      ],
      "default": "image"
    },
    {
      "type": "image_picker",
      "id": "image_mobile",
      "label": "Mobile Image"
    },
    {
      "type": "video",
      "id": "video_mobile",
      "label": "Mobile Video"
    },
    {
      "type": "header",
      "content": "Overlay & Design"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Overlay Color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 90,
      "step": 5,
      "unit": "%",
      "label": "Overlay Opacity",
      "default": 30
    },
    {
      "type": "checkbox",
      "id": "show_accent_line",
      "label": "Show Bottom Accent Line",
      "default": true
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow Text",
      "default": "Spring 2026"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Headline",
      "default": "Ethereal Minimalism"
    },
    {
      "type": "textarea",
      "id": "text",
      "label": "Subheadline",
      "default": "Where simplicity meets sophistication"
    },
    {
      "type": "text",
      "id": "link_text",
      "label": "Button Label",
      "default": "Explore Collection"
    },
    {
      "type": "url",
      "id": "link",
      "label": "Button Link"
    }
  ],
  "presets": [
    {
      "name": "Ryssa Hero"
    }
  ]
}
{% endschema %}