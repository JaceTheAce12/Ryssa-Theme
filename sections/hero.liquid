{%- comment -%}
  ----------------------------------------------------------------------------------
  RYSSA HERO SECTION
  - Includes: HTML/Liquid, CSS, and Optimized Hero-Specific JS
  ----------------------------------------------------------------------------------
{%- endcomment -%}

{% liquid
  # --- Performance Logic ---
  assign loading_attr = 'lazy'
  assign fetch_priority_attr = 'auto'
  
  if section.index == 1
    assign loading_attr = 'eager'
    assign fetch_priority_attr = 'high'
  endif

  # --- Media Logic ---
  assign desktop_media_type = section.settings.desktop_media_type
  assign mobile_media_type = section.settings.mobile_media_type
  
  # Check if mobile media exists
  assign has_mobile_media = false
  if mobile_media_type == 'image' and section.settings.image_mobile != blank
    assign has_mobile_media = true
  elsif mobile_media_type == 'video' and section.settings.video_mobile != blank
    assign has_mobile_media = true
  endif
%}

<section class="hero" data-section-id="{{ section.id }}">
  
  <div class="hero__background parallax-element">
    
    {%- comment -%} 1. VIDEO PLAYERS {%- endcomment -%}
    
    {%- if desktop_media_type == 'video' and section.settings.video_desktop != blank -%}
      <div class="hero-media-container desktop-only">
        {{ section.settings.video_desktop | video_tag: autoplay: true, loop: true, muted: true, controls: false, class: 'hero__media-item', image_size: '1920x' }}
      </div>
    {%- endif -%}

    {%- if has_mobile_media and mobile_media_type == 'video' -%}
      <div class="hero-media-container mobile-only">
        {{ section.settings.video_mobile | video_tag: autoplay: true, loop: true, muted: true, controls: false, class: 'hero__media-item', image_size: '800x' }}
      </div>
    {%- endif -%}

    {%- comment -%} 2. IMAGES (Picture Tag) {%- endcomment -%}
    
    {%- if desktop_media_type == 'image' or has_mobile_media -%}
      {%- unless desktop_media_type == 'video' and mobile_media_type == 'video' -%}
        <picture>
          {%- comment -%} Mobile Source {%- endcomment -%}
          {%- if has_mobile_media and mobile_media_type == 'image' -%}
            <source 
              media="(max-width: 767px)" 
              srcset="{{ section.settings.image_mobile | image_url: width: 400 }} 400w, 
                      {{ section.settings.image_mobile | image_url: width: 600 }} 600w, 
                      {{ section.settings.image_mobile | image_url: width: 800 }} 800w"
            >
          {%- endif -%}

          {%- comment -%} Desktop Source {%- endcomment -%}
          {%- if desktop_media_type == 'image' and section.settings.image_desktop != blank -%}
             <source 
              media="(min-width: 768px)" 
              srcset="{{ section.settings.image_desktop | image_url: width: 1200 }} 1200w, 
                      {{ section.settings.image_desktop | image_url: width: 1600 }} 1600w, 
                      {{ section.settings.image_desktop | image_url: width: 2000 }} 2000w,
                      {{ section.settings.image_desktop | image_url: width: 3000 }} 3000w"
            >
            {%- assign main_image = section.settings.image_desktop -%}
          {%- elsif has_mobile_media and mobile_media_type == 'image' -%}
            {%- assign main_image = section.settings.image_mobile -%}
          {%- else -%}
             {%- assign main_image = blank -%}
          {%- endif -%}

          {%- if main_image != blank -%}
            {{ main_image | image_url: width: 3840 | image_tag:
              loading: loading_attr,
              fetchpriority: fetch_priority_attr,
              alt: main_image.alt,
              class: 'hero__media-item'
            }}
          {%- else -%}
            {%- if desktop_media_type == 'image' -%}
              {{ 'lifestyle-1' | placeholder_svg_tag: 'hero__media-item placeholder-svg' }}
            {%- endif -%}
          {%- endif -%}
        </picture>
      {%- endunless -%}
    {%- endif -%}

    <div class="hero__overlay" style="background-color: {{ section.settings.overlay_color }}; opacity: {{ section.settings.overlay_opacity | divided_by: 100.0 }}"></div>
    
    {%- if section.settings.show_accent_line -%}
      <div class="hero__accent-line"></div>
    {%- endif -%}
  </div>

  <div class="hero__content fade-in">
    {%- if section.settings.eyebrow != blank -%}
      <span class="hero__eyebrow">{{ section.settings.eyebrow }}</span>
    {%- endif -%}
    
    {%- if section.settings.title != blank -%}
      <h1 class="hero__headline">{{ section.settings.title }}</h1>
    {%- endif -%}
    
    {%- if section.settings.text != blank -%}
      <p class="hero__subheadline">{{ section.settings.text }}</p>
    {%- endif -%}
    
    {%- if section.settings.link_text != blank and section.settings.link != blank -%}
      <a href="{{ section.settings.link }}" class="button button--primary hero__cta">
        {{ section.settings.link_text }}
      </a>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "Ryssa Hero",
  "settings": [
    {
      "type": "header",
      "content": "Desktop Media"
    },
    {
      "type": "select",
      "id": "desktop_media_type",
      "label": "Media Type",
      "options": [
        { "value": "image", "label": "Image" },
        { "value": "video", "label": "Video" }
      ],
      "default": "image"
    },
    {
      "type": "image_picker",
      "id": "image_desktop",
      "label": "Image"
    },
    {
      "type": "video",
      "id": "video_desktop",
      "label": "Video (MP4/Shopify Hosted)"
    },
    {
      "type": "header",
      "content": "Mobile Media (Optional)"
    },
    {
      "type": "paragraph",
      "content": "If left blank, desktop media will be used."
    },
    {
      "type": "select",
      "id": "mobile_media_type",
      "label": "Mobile Media Type",
      "options": [
        { "value": "image", "label": "Image" },
        { "value": "video", "label": "Video" }
      ],
      "default": "image"
    },
    {
      "type": "image_picker",
      "id": "image_mobile",
      "label": "Mobile Image"
    },
    {
      "type": "video",
      "id": "video_mobile",
      "label": "Mobile Video"
    },
    {
      "type": "header",
      "content": "Overlay & Design"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Overlay Color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 90,
      "step": 5,
      "unit": "%",
      "label": "Overlay Opacity",
      "default": 30
    },
    {
      "type": "checkbox",
      "id": "show_accent_line",
      "label": "Show Bottom Accent Line",
      "default": true
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow Text",
      "default": "Spring 2026"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Headline",
      "default": "Ethereal Minimalism"
    },
    {
      "type": "textarea",
      "id": "text",
      "label": "Subheadline",
      "default": "Where simplicity meets sophistication"
    },
    {
      "type": "text",
      "id": "link_text",
      "label": "Button Label",
      "default": "Explore Collection"
    },
    {
      "type": "url",
      "id": "link",
      "label": "Button Link"
    }
  ],
  "presets": [
    {
      "name": "Ryssa Hero"
    }
  ]
}
{% endschema %}

{% stylesheet %}
  /* ========================================
     HELPER CLASSES 
     ======================================== */
  .desktop-only { display: block; }
  .mobile-only { display: none; }
  
  .hero-media-container {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0;
  }
  
  .hero__media-item {
    width: 100%;
    height: 100%;
    object-fit: cover;
    position: absolute;
    top: 0; left: 0;
  }

  @media screen and (max-width: 767px) {
    .desktop-only { display: none; }
    .mobile-only { display: block; }
  }

  /* ========================================
     MAIN HERO CSS
     ======================================== */
  .hero {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 600px;
    height: 100vh;
    max-height: 900px;
    overflow: hidden;
  }

  .hero__background {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    z-index: 1;
  }

  .hero__overlay {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background: linear-gradient(
      180deg,
      rgba(233, 245, 255, 0.08) 0%,
      rgba(0, 0, 0, 0.3) 100%
    );
  }

  .hero__accent-line {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(
      90deg,
      transparent 0%,
      var(--color-primary) 30%,
      var(--color-primary-hover) 50%,
      var(--color-primary) 70%,
      transparent 100%
    );
    z-index: 3;
    opacity: 0.7;
  }

  .hero__content {
    position: relative;
    z-index: 2;
    text-align: center;
    color: var(--color-white);
    padding: var(--spacing-md);
    max-width: 800px;
  }

  .hero__eyebrow {
    display: block;
    font-size: 14px;
    font-weight: var(--font-semibold);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
    margin-bottom: var(--spacing-sm);
    opacity: 0.9;
  }

  .hero__headline {
    font-size: clamp(48px, 8vw, 96px);
    font-weight: var(--font-light);
    letter-spacing: var(--tracking-tight);
    text-transform: uppercase;
    margin-bottom: var(--spacing-sm);
    color: var(--color-white);
  }

  .hero__subheadline {
    font-size: var(--text-xl);
    font-weight: var(--font-light);
    letter-spacing: var(--tracking-wide);
    margin-bottom: var(--spacing-lg);
    opacity: 0.95;
  }

  .hero__cta {
    margin-top: var(--spacing-lg);
  }

  /* BUTTONS */
  .button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 16px 40px;
    font-size: 14px;
    font-weight: var(--font-medium);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wide);
    border: 1px solid transparent;
    cursor: pointer;
    transition: all var(--duration-base) var(--ease-smooth);
    min-width: 200px;
  }

  .button--primary {
    background-color: var(--color-black);
    color: var(--color-white);
    border-color: var(--color-black);
  }

  .button--primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .button--primary:focus-visible {
    outline: 2px solid var(--color-primary-dark);
    outline-offset: 3px;
  }

  .button--primary:active {
    transform: translateY(0);
    box-shadow: var(--shadow-sm);
  }
{% endstylesheet %}

<script>
(function() {
  'use strict';

  // Helper: Debounce
  function debounce(func, wait = 250) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  /* ========================================
     FADE IN ANIMATIONS
     ======================================== */
  class FadeInObserver {
    constructor() {
      // Limit to this section to avoid conflicts if used elsewhere
      this.elements = document.querySelectorAll('.hero .fade-in'); 
      this.options = { threshold: 0.1, rootMargin: '-50px' };
      this.init();
    }

    init() {
      if (!('IntersectionObserver' in window)) {
        this.elements.forEach(el => el.classList.add('visible'));
        return;
      }

      this.observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
             // Immediate add for hero to prevent delay on load
            entry.target.classList.add('visible');
            this.observer.unobserve(entry.target);
          }
        });
      }, this.options);

      this.elements.forEach(el => this.observer.observe(el));
    }
  }

  /* ========================================
     PARALLAX EFFECT
     ======================================== */
  class ParallaxEffect {
    constructor() {
      this.elements = document.querySelectorAll('.parallax-element');
      this.ticking = false;
      this.speed = 0.3; 
      this.init();
    }

    init() {
      if (this.elements.length === 0) return;
      
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (prefersReducedMotion) return;

      window.addEventListener('scroll', () => {
        if (!this.ticking) {
          window.requestAnimationFrame(() => {
            this.updateParallax();
            this.ticking = false;
          });
          this.ticking = true;
        }
      }, { passive: true });
    }

    updateParallax() {
      const scrollY = window.scrollY;
      this.elements.forEach(element => {
        const rect = element.getBoundingClientRect();
        const elementTop = rect.top + scrollY;
        const elementHeight = element.offsetHeight;
        const viewportHeight = window.innerHeight;

        if (scrollY + viewportHeight > elementTop && scrollY < elementTop + elementHeight) {
          const yPos = (scrollY - elementTop) * this.speed;
          element.style.transform = `translateY(${yPos}px)`;
        }
      });
    }
  }

  /* ========================================
     LAZY LOAD FALLBACK
     ======================================== */
  class LazyLoadImages {
    constructor() {
      this.images = document.querySelectorAll('.hero img[loading="lazy"]');
      this.init();
    }

    init() {
      if ('loading' in HTMLImageElement.prototype) return;

      if (!('IntersectionObserver' in window)) {
        this.images.forEach(img => this.loadImage(img));
        return;
      }

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            this.loadImage(entry.target);
            observer.unobserve(entry.target);
          }
        });
      }, { rootMargin: '50px' });

      this.images.forEach(img => observer.observe(img));
    }

    loadImage(img) {
      if (img.dataset.src) {
        img.src = img.dataset.src;
        img.removeAttribute('data-src');
      }
    }
  }

  // Initialize Modules
  function init() {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeModules);
    } else {
      initializeModules();
    }
  }

  function initializeModules() {
    new FadeInObserver();
    new ParallaxEffect();
    new LazyLoadImages();
  }

  init();

  window.addEventListener('resize', debounce(() => {
    // Parallax recalcs handled automatically by scroll loop
  }, 250));

})();
</script>