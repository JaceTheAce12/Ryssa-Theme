{%- comment -%}
  ----------------------------------------------------------------------------------
  RYSSA HEADER - Custom Implementation
  Includes: HTML Structure, Schema Settings, CSS Design System, and Interactivity JS
  - Fix: Added body padding to prevent header from covering page titles
  ----------------------------------------------------------------------------------
{%- endcomment -%}

<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap');
</style>

<header 
  class="site-header" 
  data-section-id="{{ section.id }}" 
  id="SiteHeader"
>
  <div class="site-header__inner">
    
    <button type="button" class="site-header__menu-toggle" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-nav">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <a href="{{ routes.root_url }}" class="site-header__logo" aria-label="{{ shop.name }}">
      {%- if section.settings.logo != blank -%}
        {%- assign logo_alt = section.settings.logo.alt | default: shop.name | escape -%}
        {{ section.settings.logo | image_url: width: section.settings.logo_width | image_tag: 
          class: 'site-header__logo-image',
          widths: '50, 100, 150, 200, 250, 300, 400, 500',
          height: 'auto',
          alt: logo_alt
        }}
      {%- else -%}
        <svg width="120" height="32" viewBox="0 0 120 32" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
          <text x="0" y="24" font-family="Playfair Display, serif" font-size="24" font-weight="300" fill="currentColor">RYSSA</text>
        </svg>
      {%- endif -%}
    </a>

    <nav class="site-header__nav" aria-label="Primary navigation">
      <ul class="site-header__menu">
        {%- for link in linklists[section.settings.menu].links -%}
          <li>
            <a href="{{ link.url }}" class="{% if link.active %}active{% endif %}">
              {{ link.title }}
            </a>
          </li>
        {%- endfor -%}
      </ul>
    </nav>

    <div class="site-header__actions">
      
      {%- if section.settings.show_search -%}
        <button type="button" class="site-header__action-btn js-search-toggle" aria-label="Search">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
            <circle cx="9" cy="9" r="6" stroke-width="1.5"/>
            <path d="M13.5 13.5L17 17" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
      {%- endif -%}

      {%- if shop.customer_accounts_enabled -%}
        <a href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}" class="site-header__action-btn" aria-label="Account">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
            <circle cx="10" cy="7" r="3.5" stroke-width="1.5"/>
            <path d="M4 17C4 13.6863 6.68629 11 10 11C13.3137 11 16 13.6863 16 17" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </a>
      {%- endif -%}

      <a href="{{ routes.cart_url }}" class="site-header__action-btn site-header__cart" aria-label="Cart">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
          <path d="M3 3H4.5L6.5 13H16.5L18.5 6H6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="7.5" cy="16.5" r="1" fill="currentColor"/>
          <circle cx="15.5" cy="16.5" r="1" fill="currentColor"/>
        </svg>
        {%- if cart.item_count > 0 -%}
          <span class="cart-count">{{ cart.item_count }}</span>
        {%- endif -%}
      </a>
    </div>
  </div>

  <div class="site-header__search-bar" aria-hidden="true">
    <div class="container">
      <form action="{{ routes.search_url }}" method="get" role="search" class="search-form">
        <input type="hidden" name="type" value="product">
        
        <button type="submit" class="search-form__submit" aria-label="Submit search">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
            <circle cx="9" cy="9" r="6" stroke-width="1.5"/>
            <path d="M13.5 13.5L17 17" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>

        <input 
          type="search" 
          name="q" 
          value="{{ search.terms | escape }}" 
          placeholder="Search..." 
          class="search-form__input"
          aria-label="Search"
        >

        <button type="button" class="search-form__close js-search-close" aria-label="Close search">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor">
            <path d="M1 1L13 13M13 1L1 13" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </form>
    </div>
  </div>

</header>

<div class="mobile-nav-overlay" id="mobile-nav" aria-hidden="true">
  <nav class="mobile-nav" aria-label="Mobile navigation">
    <ul class="mobile-nav__menu">
      {%- for link in linklists[section.settings.menu].links -%}
        <li><a href="{{ link.url }}">{{ link.title }}</a></li>
      {%- endfor -%}
    </ul>
  </nav>
</div>

{% schema %}
{
  "name": "Ryssa Header",
  "settings": [
    {
      "type": "header",
      "content": "Logo"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Image"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 300,
      "step": 10,
      "default": 120,
      "unit": "px",
      "label": "Logo Width"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Main Menu"
    },
    {
      "type": "header",
      "content": "Options"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "default": true,
      "label": "Show Search Icon"
    }
  ]
}
{% endschema %}

{% stylesheet %}
  /* ========================================
     CSS CUSTOM PROPERTIES
     ======================================== */

  :root {
    /* Colors - Neutrals */
    --color-white: #FFFFFF;
    --color-cloud: #F8F6F3;
    --color-sand: #E3DAC9;
    --color-taupe: #CAB9A9;
    --color-mocha: #A89788;
    --color-charcoal: #3A3632;
    --color-black: #1A1A1A;

    /* Colors - Accent */
    --color-accent-primary: #8B7355;
    --color-accent-secondary: #2C3E50;

    /* Colors - Primary Accent (Pale Blue) */
    --color-primary: #e9f5ff;
    --color-primary-hover: #d4ecff; /* Pale Blue for Hovers */
    --color-primary-dark: #c0e3ff;

    /* Colors - Semantic */
    --color-text-primary: var(--color-black);
    --color-text-secondary: #525252;
    --color-background-primary: var(--color-white);
    --color-background-secondary: var(--color-cloud);

    /* Typography */
    --font-display: 'Playfair Display', Georgia, serif;
    --font-body: 'Inter', 'Helvetica Neue', Arial, sans-serif;
    
    --text-base: 1rem;
    --text-xl: 1.563rem;

    /* Spacing */
    --spacing-xs: 8px;
    --spacing-sm: 16px;
    --spacing-md: 24px;
    --spacing-xl: 48px;
    --spacing-2xl: 80px;

    /* Animation */
    --ease-smooth: cubic-bezier(0.16, 1, 0.3, 1);
    --ease-default: ease;
    --duration-fast: 150ms;
    --duration-base: 300ms;

    /* Border Colors */
    --color-border-light: #E8E8E8;
    --color-border-subtle: rgba(0, 0, 0, 0.08);
  }

  /* ========================================
     CSS RESET & BASE STYLES
     ======================================== */

  *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  html {
    scroll-behavior: smooth;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  body {
    font-family: var(--font-body);
    font-size: var(--text-base);
    font-weight: var(--font-regular);
    line-height: var(--leading-relaxed);
    color: var(--color-text-primary);
    background-color: var(--color-background-primary);
    overflow-x: hidden;
    
    /* FIX: Add top padding equal to header height (80px + 1px border) */
    /* This prevents the fixed header from covering page titles */
    padding-top: 81px; 
  }

  img,
  picture,
  video,
  canvas,
  svg {
    display: block;
    max-width: 100%;
  }

  img {
    height: auto;
  }

  button,
  input,
  textarea,
  select {
    font: inherit;
  }

  a {
    color: inherit;
    text-decoration: none;
  }

  ul,
  ol {
    list-style: none;
  }

  button {
    background: none;
    border: none;
    cursor: pointer;
  }

  /* ========================================
     SITE HEADER STYLES
     ======================================== */

  .site-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background-color: var(--color-white);
    border-bottom: 1px solid var(--color-border-light);
    transition: transform var(--duration-base) var(--ease-default);
  }

  .site-header--hidden {
    transform: translateY(-100%);
  }

  .site-header__inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 80px;
    max-width: 1440px;
    margin: 0 auto;
    padding: 0 var(--spacing-md);
    background-color: var(--color-white);
    position: relative;
    z-index: 20;
  }

  .site-header__logo svg {
    display: block;
    color: var(--color-black);
    transition: opacity var(--duration-fast) var(--ease-default);
  }

  .site-header__logo:hover svg {
    opacity: 0.7;
  }

  /* --- Desktop Navigation --- */
  .site-header__nav {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
  }

  .site-header__menu {
    display: flex;
    gap: var(--spacing-xl);
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .site-header__menu a {
    font-size: 14px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    text-decoration: none;
    color: inherit;
    transition: color var(--duration-fast) var(--ease-default);
    position: relative;
  }

  /* Pale Blue Underline Effect */
  .site-header__menu a::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 2px;
    background-color: var(--color-primary-hover);
    transition: width var(--duration-base) var(--ease-smooth);
  }

  .site-header__menu a:hover,
  .site-header__menu a.active {
    color: var(--color-accent-primary);
  }

  .site-header__menu a:hover::after,
  .site-header__menu a.active::after {
    width: 100%;
  }

  .site-header__menu a:active {
    color: var(--color-charcoal);
  }

  /* --- Mobile Menu Toggle (Hamburger) --- */
  .site-header__menu-toggle {
    display: none;
    flex-direction: column;
    gap: 5px;
    
    /* RESET BUTTON STYLES */
    background: transparent;
    border: none;
    padding: 8px; /* Touch target */
    cursor: pointer;
    
    align-items: center;
    justify-content: center;
    position: relative;
    z-index: 10;
  }

  .site-header__menu-toggle span {
    display: block;
    width: 24px;
    height: 2px;
    background-color: var(--color-black); /* Crucial: ensures lines are visible */
    transition: all var(--duration-base) var(--ease-smooth);
  }

  /* Hamburger Animation: Move THEN Rotate for perfect center */
  .site-header__menu-toggle[aria-expanded="true"] span:nth-child(1) {
    transform: translateY(7px) rotate(45deg);
  }

  .site-header__menu-toggle[aria-expanded="true"] span:nth-child(2) {
    opacity: 0;
  }

  .site-header__menu-toggle[aria-expanded="true"] span:nth-child(3) {
    transform: translateY(-7px) rotate(-45deg);
  }

  /* --- Header Actions --- */
  .site-header__actions {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
  }

  .site-header__action-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    
    /* RESET BUTTON STYLES */
    background: transparent;
    border: none;
    cursor: pointer;
    
    min-width: 44px;
    min-height: 44px;
    color: var(--color-black);
    transition: opacity var(--duration-fast) var(--ease-default);
  }

  .site-header__action-btn:hover {
    opacity: 0.6;
  }

  .site-header__action-btn:active {
    opacity: 0.4;
  }

  .site-header__action-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .site-header__cart {
    position: relative;
  }

  .cart-count {
    position: absolute;
    top: var(--spacing-xs);
    right: var(--spacing-xs);
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 18px;
    height: 18px;
    padding: 0 4px;
    font-size: 10px;
    font-weight: 600;
    color: var(--color-white);
    background-color: var(--color-black);
    border-radius: 50%;
    line-height: 1;
  }

  /* --- Mobile Navigation Overlay --- */
  .mobile-nav-overlay {
    position: fixed;
    top: 80px;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--color-white);
    z-index: 999;
    opacity: 0;
    visibility: hidden;
    transition: opacity var(--duration-base) var(--ease-default),
                visibility var(--duration-base) var(--ease-default);
  }

  .mobile-nav-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .mobile-nav {
    padding: var(--spacing-xl) var(--spacing-md);
  }

  .mobile-nav__menu {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .mobile-nav__menu a {
    font-size: var(--text-xl);
    font-family: var(--font-display);
    font-weight: 300;
    letter-spacing: -0.02em;
    padding: var(--spacing-sm) 0;
    border-bottom: 1px solid var(--color-border-subtle);
    display: block;
    text-decoration: none;
    color: inherit;
    transition: color var(--duration-fast) var(--ease-default),
                background-color var(--duration-fast) var(--ease-default);
  }

  .mobile-nav__menu a:hover {
    color: var(--color-accent-primary);
    background-color: rgba(139, 115, 85, 0.08);
  }

  /* --- INLINE SEARCH BAR --- */
  .site-header__search-bar {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--color-white);
    z-index: 30;
    display: flex;
    align-items: center;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
  }

  .site-header__search-bar.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .site-header__search-bar .container {
    width: 100%;
    max-width: 1440px;
    margin: 0 auto;
    padding: 0 24px;
  }

  .search-form {
    display: flex;
    align-items: center;
    width: 100%;
    gap: 12px;
  }

  .search-form__input {
    flex: 1;
    border: none;
    border-bottom: 1px solid transparent;
    font-family: var(--font-body);
    font-size: 16px;
    padding: 8px 0;
    outline: none;
    background: transparent;
    transition: border-color 0.2s ease;
  }

  .search-form__input:focus {
    border-bottom-color: var(--color-black);
  }

  .search-form__submit,
  .search-form__close {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--color-black);
    padding: 8px;
    display: flex;
    align-items: center;
  }

  /* ========================================
     RESPONSIVE BREAKPOINTS
     ======================================== */

  /* Tablet (768px) */
  @media (max-width: 768px) {
    .site-header__nav {
      display: none;
    }

    .site-header__menu-toggle {
      display: flex;
    }

    .site-header__logo {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1;
      display: flex;
      justify-content: center;
      max-width: 50%; /* Prevent overlapping */
    }
    
    .site-header__logo img,
    .site-header__logo svg {
      max-width: 100%;
      height: auto;
    }

    .site-header__actions {
      gap: 8px; /* Tighter gap on tablet */
      position: relative;
      z-index: 10;
    }
  }

  /* Tiny Screens (<400px) FIX */
  @media (max-width: 400px) {
    .site-header__inner {
      padding: 0 12px;
    }
    .site-header__logo {
      max-width: 100px; /* Aggressive fix for logo overlap */
    }
    .site-header__actions {
      gap: 4px; /* Minimal gap */
    }
  }
{% endstylesheet %}

<script>
(function() {
  'use strict';

  /* ========================================
     SEARCH TOGGLE LOGIC
     ======================================== */
  class SearchToggle {
    constructor() {
      this.trigger = document.querySelector('.js-search-toggle');
      this.closeBtn = document.querySelector('.js-search-close');
      this.searchBar = document.querySelector('.site-header__search-bar');
      this.input = document.querySelector('.search-form__input');

      if (this.trigger && this.searchBar) {
        this.init();
      }
    }

    init() {
      this.trigger.addEventListener('click', (e) => {
        e.preventDefault();
        this.open();
      });

      this.closeBtn.addEventListener('click', () => this.close());

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && this.isOpen()) {
          this.close();
        }
      });
    }

    open() {
      this.searchBar.classList.add('active');
      this.searchBar.setAttribute('aria-hidden', 'false');
      setTimeout(() => this.input.focus(), 100);
    }

    close() {
      this.searchBar.classList.remove('active');
      this.searchBar.setAttribute('aria-hidden', 'true');
    }

    isOpen() {
      return this.searchBar.classList.contains('active');
    }
  }

  /* ========================================
     MOBILE MENU & SCROLL LOGIC
     ======================================== */
  class HeaderLogic {
    constructor() {
      this.initMenu();
      this.initScroll();
    }

    initMenu() {
      const toggle = document.querySelector('.site-header__menu-toggle');
      const overlay = document.querySelector('.mobile-nav-overlay');
      
      if(!toggle || !overlay) return;

      toggle.addEventListener('click', () => {
        const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
        toggle.setAttribute('aria-expanded', !isExpanded);
        overlay.classList.toggle('active');
        document.body.style.overflow = isExpanded ? '' : 'hidden';
      });
    }

    initScroll() {
      let lastScroll = window.scrollY;
      const header = document.querySelector('.site-header');
      
      window.addEventListener('scroll', () => {
        const currentScroll = window.scrollY;
        if(currentScroll > lastScroll && currentScroll > 100) {
          header.classList.add('site-header--hidden');
        } else {
          header.classList.remove('site-header--hidden');
        }
        lastScroll = currentScroll;
      }, { passive: true });
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    new SearchToggle();
    new HeaderLogic();
  });

})();
</script>