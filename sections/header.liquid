{%- comment -%}
  ----------------------------------------------------------------------------------
  RYSSA HEADER - Custom Implementation
  Includes: Inline Search Bar, Mobile Logic, and Animations
  ----------------------------------------------------------------------------------
{%- endcomment -%}

<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap');
</style>

<header 
  class="site-header" 
  data-section-id="{{ section.id }}" 
  id="SiteHeader"
>
  <div class="site-header__inner">
    
    <button class="site-header__menu-toggle" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-nav">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <a href="{{ routes.root_url }}" class="site-header__logo" aria-label="{{ shop.name }}">
      {%- if section.settings.logo != blank -%}
        {%- assign logo_alt = section.settings.logo.alt | default: shop.name | escape -%}
        {{ section.settings.logo | image_url: width: section.settings.logo_width | image_tag: 
          class: 'site-header__logo-image',
          widths: '50, 100, 150, 200, 250, 300, 400, 500',
          height: 'auto',
          alt: logo_alt
        }}
      {%- else -%}
        <svg width="120" height="32" viewBox="0 0 120 32" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
          <text x="0" y="24" font-family="Playfair Display, serif" font-size="24" font-weight="300" fill="currentColor">RYSSA</text>
        </svg>
      {%- endif -%}
    </a>

    <nav class="site-header__nav" aria-label="Primary navigation">
      <ul class="site-header__menu">
        {%- for link in linklists[section.settings.menu].links -%}
          <li>
            <a href="{{ link.url }}" class="{% if link.active %}active{% endif %}">
              {{ link.title }}
            </a>
          </li>
        {%- endfor -%}
      </ul>
    </nav>

    <div class="site-header__actions">
      
      {%- if section.settings.show_search -%}
        <button type="button" class="site-header__action-btn js-search-toggle" aria-label="Search">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
            <circle cx="9" cy="9" r="6" stroke-width="1.5"/>
            <path d="M13.5 13.5L17 17" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
      {%- endif -%}

      {%- if shop.customer_accounts_enabled -%}
        <a href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}" class="site-header__action-btn" aria-label="Account">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
            <circle cx="10" cy="7" r="3.5" stroke-width="1.5"/>
            <path d="M4 17C4 13.6863 6.68629 11 10 11C13.3137 11 16 13.6863 16 17" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </a>
      {%- endif -%}

      <a href="{{ routes.cart_url }}" class="site-header__action-btn site-header__cart" aria-label="Cart">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
          <path d="M3 3H4.5L6.5 13H16.5L18.5 6H6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="7.5" cy="16.5" r="1" fill="currentColor"/>
          <circle cx="15.5" cy="16.5" r="1" fill="currentColor"/>
        </svg>
        {%- if cart.item_count > 0 -%}
          <span class="cart-count">{{ cart.item_count }}</span>
        {%- endif -%}
      </a>
    </div>
  </div>

  <div class="site-header__search-bar" aria-hidden="true">
    <div class="container">
      <form action="{{ routes.search_url }}" method="get" role="search" class="search-form">
        <input type="hidden" name="type" value="product">
        
        <button type="submit" class="search-form__submit" aria-label="Submit search">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
            <circle cx="9" cy="9" r="6" stroke-width="1.5"/>
            <path d="M13.5 13.5L17 17" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>

        <input 
          type="search" 
          name="q" 
          value="{{ search.terms | escape }}" 
          placeholder="Search for..." 
          class="search-form__input"
          aria-label="Search"
        >

        <button type="button" class="search-form__close js-search-close" aria-label="Close search">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor">
            <path d="M1 1L13 13M13 1L1 13" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </form>
    </div>
  </div>

</header>

<div class="mobile-nav-overlay" id="mobile-nav" aria-hidden="true">
  <nav class="mobile-nav" aria-label="Mobile navigation">
    <ul class="mobile-nav__menu">
      {%- for link in linklists[section.settings.menu].links -%}
        <li><a href="{{ link.url }}">{{ link.title }}</a></li>
      {%- endfor -%}
    </ul>
  </nav>
</div>

{% schema %}
{
  "name": "Ryssa Header",
  "settings": [
    {
      "type": "header",
      "content": "Logo"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Image"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 300,
      "step": 10,
      "default": 120,
      "unit": "px",
      "label": "Logo Width"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Main Menu"
    },
    {
      "type": "header",
      "content": "Options"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "default": true,
      "label": "Show Search Icon"
    }
  ]
}
{% endschema %}

{% stylesheet %}
  /* ========================================
     CSS VARIABLES & RESET
     ======================================== */
  :root {
    --color-white: #FFFFFF;
    --color-black: #1A1A1A;
    --color-border-light: #E8E8E8;
    --font-display: 'Playfair Display', serif;
    --font-body: 'Inter', sans-serif;
    --duration-base: 300ms;
    --ease-default: ease;
  }

  /* ========================================
     SITE HEADER STYLES
     ======================================== */
  .site-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background-color: var(--color-white);
    border-bottom: 1px solid var(--color-border-light);
    transition: transform var(--duration-base) var(--ease-default);
  }

  .site-header__inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 80px;
    max-width: 1440px;
    margin: 0 auto;
    padding: 0 24px;
    background-color: var(--color-white); /* Ensure background obscures content */
    position: relative;
    z-index: 20; /* Above search bar layer */
  }

  /* Navigation */
  .site-header__nav {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
  }

  .site-header__menu {
    display: flex;
    gap: 32px;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .site-header__menu a {
    text-decoration: none;
    color: var(--color-black);
    font-family: var(--font-body);
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  /* Actions */
  .site-header__actions {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .site-header__action-btn {
    background: none;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-black);
    padding: 4px;
  }

  /* Cart Badge */
  .site-header__cart { position: relative; }
  .cart-count {
    position: absolute;
    top: -2px;
    right: -4px;
    background: var(--color-black);
    color: var(--color-white);
    font-size: 10px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* ========================================
     INLINE SEARCH BAR CSS
     ======================================== */
  .site-header__search-bar {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--color-white);
    z-index: 30; /* Sit on top of everything inside header */
    display: flex;
    align-items: center;
    
    /* Animation State: Hidden (Slide Up) */
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
  }

  /* Animation State: Active (Slide Down) */
  .site-header__search-bar.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .site-header__search-bar .container {
    width: 100%;
    max-width: 1440px;
    margin: 0 auto;
    padding: 0 24px;
  }

  .search-form {
    display: flex;
    align-items: center;
    width: 100%;
    gap: 12px;
  }

  .search-form__input {
    flex: 1;
    border: none;
    border-bottom: 1px solid transparent;
    font-family: var(--font-body);
    font-size: 16px;
    padding: 8px 0;
    outline: none;
    background: transparent;
    transition: border-color 0.2s ease;
  }

  .search-form__input:focus {
    border-bottom-color: var(--color-black);
  }

  .search-form__submit,
  .search-form__close {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--color-black);
    padding: 8px;
    display: flex;
    align-items: center;
  }

  .search-form__close:hover {
    opacity: 0.6;
  }

  /* ========================================
     MOBILE & RESPONSIVE FIXES
     ======================================== */
  
  .site-header__menu-toggle {
    display: none;
    flex-direction: column;
    gap: 5px;
    background: none;
    border: none;
    cursor: pointer;
    position: relative;
    z-index: 10;
  }

  .site-header__menu-toggle span {
    width: 24px;
    height: 2px;
    background-color: var(--color-black);
    transition: all 0.3s ease;
  }

  /* Hamburger Animation */
  .site-header__menu-toggle[aria-expanded="true"] span:nth-child(1) {
    transform: translateY(7px) rotate(45deg);
  }
  .site-header__menu-toggle[aria-expanded="true"] span:nth-child(2) {
    opacity: 0;
  }
  .site-header__menu-toggle[aria-expanded="true"] span:nth-child(3) {
    transform: translateY(-7px) rotate(-45deg);
  }

  @media (max-width: 768px) {
    .site-header__nav { display: none; }
    .site-header__menu-toggle { display: flex; }
    
    .site-header__logo {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1;
      display: flex;
      justify-content: center;
      max-width: 50%; /* Prevent overlap on standard mobile */
    }

    /* Tighter spacing for mobile icons */
    .site-header__actions {
      gap: 8px;
      position: relative;
      z-index: 10;
    }
  }

  /* TINY SCREEN FIX (<400px) */
  @media (max-width: 400px) {
    .site-header__inner { padding: 0 12px; }
    
    .site-header__logo {
      max-width: 100px; /* Aggressively shrink logo to fit */
    }
    
    .site-header__actions {
      gap: 4px; /* Minimal gap between search/cart */
    }
  }

  /* Mobile Nav Overlay */
  .mobile-nav-overlay {
    position: fixed;
    top: 80px; left: 0; right: 0; bottom: 0;
    background: var(--color-white);
    z-index: 999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }
  .mobile-nav-overlay.active { opacity: 1; visibility: visible; }
  .mobile-nav { padding: 40px 24px; }
  .mobile-nav__menu { list-style: none; padding: 0; display: flex; flex-direction: column; gap: 24px; }
  .mobile-nav__menu a { font-size: 24px; text-decoration: none; color: var(--color-black); font-family: var(--font-display); }
{% endstylesheet %}

<script>
(function() {
  'use strict';

  /* ========================================
     SEARCH TOGGLE LOGIC
     ======================================== */
  class SearchToggle {
    constructor() {
      this.trigger = document.querySelector('.js-search-toggle');
      this.closeBtn = document.querySelector('.js-search-close');
      this.searchBar = document.querySelector('.site-header__search-bar');
      this.input = document.querySelector('.search-form__input');
      this.header = document.querySelector('.site-header');

      if (this.trigger && this.searchBar) {
        this.init();
      }
    }

    init() {
      // Open Search
      this.trigger.addEventListener('click', (e) => {
        e.preventDefault();
        this.open();
      });

      // Close Search
      this.closeBtn.addEventListener('click', () => this.close());

      // Close on Escape Key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && this.isOpen()) {
          this.close();
        }
      });
    }

    open() {
      this.searchBar.classList.add('active');
      this.searchBar.setAttribute('aria-hidden', 'false');
      // Wait for animation to finish slightly before focusing to avoid jumpiness
      setTimeout(() => this.input.focus(), 100);
    }

    close() {
      this.searchBar.classList.remove('active');
      this.searchBar.setAttribute('aria-hidden', 'true');
    }

    isOpen() {
      return this.searchBar.classList.contains('active');
    }
  }

  /* ========================================
     MOBILE MENU & SCROLL (Existing Logic)
     ======================================== */
  class HeaderLogic {
    constructor() {
      this.initMenu();
      this.initScroll();
    }

    initMenu() {
      const toggle = document.querySelector('.site-header__menu-toggle');
      const overlay = document.querySelector('.mobile-nav-overlay');
      
      if(!toggle || !overlay) return;

      toggle.addEventListener('click', () => {
        const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
        toggle.setAttribute('aria-expanded', !isExpanded);
        overlay.classList.toggle('active');
        document.body.style.overflow = isExpanded ? '' : 'hidden';
      });
    }

    initScroll() {
      let lastScroll = window.scrollY;
      const header = document.querySelector('.site-header');
      
      window.addEventListener('scroll', () => {
        const currentScroll = window.scrollY;
        if(currentScroll > lastScroll && currentScroll > 100) {
          header.classList.add('site-header--hidden');
        } else {
          header.classList.remove('site-header--hidden');
        }
        lastScroll = currentScroll;
      }, { passive: true });
    }
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    new SearchToggle();
    new HeaderLogic();
  });

})();
</script>